---
title: "Nutrient Cycling in Forest Ecosystems: User Manual v.()"
author:
   Kaveh Gholamhossein Siah and
   Gregory van Der Heijden
date:  "`r format(Sys.time(), '%d %B %Y')`"
output: 
   pdf_document:
    toc: yes
    toc_depth: 2
    extra_dependencies: "subfig"
geometry: margin=2 cm
fig_caption: yes
citation_package: natbib
bibliography: Manuscript.bib
---

```{r global_options, include=FALSE, message=FALSE}
#This global option holds figures in the correct place (stops floating in pdf)
knitr::opts_chunk$set(fig.pos = 'H')

```

```{r, include=FALSE}
library(kableExtra)

```


<!--Title Page Below, possible background theme/image-->

<!--Insert List of Abbreviations-->
\newpage

## Introduction

<!--Meant to be a User guide, maybe a brief history can be mentioned at the end, but the intro should be short and descriptive-->

The Nutrient Cycling in Forested Ecosystems (NutsFor) model is
a stand-level biogeochemical model which simulates the forest nutrient dynamics of 16 chemical species <!--List species-->
NutsFor integrates several biogeochemical processes, including hydrology, soil exchange site chemistry, mineral
weathering, stand growth and uptake, and atmospheric deposition. This manual describes the most recent iteration of NutsFor (version ……), which further includes stand harvest, biomass residues, and the ability to limit plant access to nutrients in the liquid and solid phases. 

changes made to the original model described in van der Heijden et al, 2017. All
changes from the original model are noted with an asterisk (“*”). As NutsFor is an active project of Gregory van der Heijden, model capabilities are open to change based on collaboration. 

This user manual is intended to give relevant information about the model's capabilities, useful tips regarding its usage, insight into the equations and theory which link model parameters, and information on how to effectively use NutsFor in parallel to R-Studio. 



<br>

## Model Start Up

Prior to running or implementing change to model parameters, the user should go through the input and output files for NutsFor using excel. NutsFor does not currently have a built-in method to visualize results, it is recommended that the user use excel macro commands or R to automatically read generated files (which will always output with the same structure) to visualize results. This is highly important in the calibration phase of model implementation.

The model is simple to run, simply double-click or other wise enact the NutsFor.exe file. The model will run and output results to its corresponding .csv files automatically. If the output files are moved from the NutsFor directory or removed, NutsFor will generate new csv files as long as the Output folder is still present in the NutsFor.exe directory. A successful model run will be accommodated by a “Exporting Model Run Data” and “Model Run End-Press Return to Close”. Unsuccessful model runs (i.e., crashes) will result in either the NutsFor.exe closing on its own or on the former messages never appear in the NutsFor.exe terminal.

<br>

\newpage

## Input Files

There are 11 input files for NutsFor (.nut files). These
files are csv files which can be opened through excel. A full list of the input
parameters, separated by the file they appear in, is shown in the tables below.
Below each table is a more extensive description of each variable and its
effects on model outputs.

<br>

### Deposition Files

<br>

```{r, echo=FALSE}

text_tbl <- data.frame(
Input= c("Ca, Mg, K, Na, NO3, NH4, SO4, Cl, PO4, DOC, H, Al, Si"),
Units=c("$\\mu$mol/L"),
Description = c("Determines the amount of each species deposited into ecosystem by Dry Deposition")
)

kbl(text_tbl, booktabs = T, caption="Dry and Wet Deposition Files", col.names =  c("Input","Units","Description"), escape=FALSE) %>%
kable_styling(full_width = F, latex_options = "scale_down", "HOLD_position", font_size=12) 
 
```

<br>

**Description of Parameters: Deposition Files**

<br>

The dry deposition file is comparable to the Rain Concentration file. It simply delegates the deposition of chemical species without the deposition of water. The files start with An and Mois (Year and Month Columns), and then lists out chemical species from left to right. 

<br>



```{r, echo=FALSE}
#Rainfall Concentrations File
```

```{r, echo=FALSE}
#Weather Data File
```




<br>

 
### Soil Files
<br>

```{r, echo=FALSE}


Parameter<-c("Soil Layer", "Soil Layer", "Depth", "Thickness", "Bulk Density", "Solid Density", "Stoniness", "Root Fraction", "pKGibb", "pkAl precip", "pCO2", "Area", "Wilting Point", "Field Capacity", "Saturation", "CEC", "KH Cation", "Percent Mineral Area", "Uptake Fraction Per Layer (all nutrients)", "Nitrification (ks, knit)", "Microbial Turnover", "Organic Matter Parameters", "Soil Solution Initial (Multiple Species)", "Soil Adsorbed Anions Initial", "CEC Initial")

Units<-c("N/A", "N/A", "cm", "cm", "$kg/m^3$", "$kg/m^3$", "Percent", "Fraction", "N/A", "N/A", "Unknown", "$m^2/m^3$", "Percent", "Percent", "Percent", "$c{mol}_c/kg$", "N/A", "Percent", "Fraction (max 1)", "ks: $\\mu$mol/L, knit: Fraction", "Multiple of Microbial Pool", "g Nutrient/kg soil)", "$\\mu$mol/L", "$\\mu$mol/kg", "c${mol}_c$/kg")

Short_Description <-c("Desingates number of layers.", "Assigns layer number to each layer", "Tracks vertical depth of soil layer", "Designates the individual thickness of each soil layer", "N/A", "N/A", "Determines the percent of soil particles greater than 2mm in diameter", "Determines fraction of total tree root biomass in eah layer","Gibbsite formation constant","Al precipitation constant (unused in current version)", "Partial Pressure of CO2","Weatherable mineral area","Soil moisture at which stand cannot extract water", "Soil moisture after excessive water is leached", "Soil moisture at which all pore space is filled with water", "Total cation exchange capacity", "Gapon coefficients for each cation", "Porportion of total mineral area that each individually defined mineral occupies" , "Determines fraction of needed nutrient which stand uptakes from each", "Nitrification constants that determines NO3 production", "Determines fraction of SOM which turns over", "Iniital Amount of Nutrient Mineralized in the SOM pool.", "Concentration of all chemical species at beginning of simulation", "Adsorbed Concentration of anions at the beginning of the simulation", "Sorbed Concentration of Cations to the CEC at the beginning of the simulation")

text_tbl_2 <- data.frame(
Parameter, Units, Short_Description
)

kbl(text_tbl_2, caption="Soil Parameters File", booktabs = TRUE, col.names= c("Input Parameter", "Units", "Description"), escape=FALSE) %>% kable_styling(full_width = F, latex_options = c("scale_down", "striped", "hold_position"), font_size=12)

```

<br>

**Description of Parameters: Soil Parameters**

<!--Keep concise but informative-->

***Soil Layers:***

NutsFor allows any number of soil layers to be set in the
model. Extra layers are added by typing in the new layer quantity into the
Soil_Layer parameter, and adding the new layer to the Soil Parameter file by
parameterizing the new layer as is done for layers before it. When a new layer
is added, the spacing between the different tables in the soil parameters file
is offset, the tables must be cut and pasted such that a single row of blank
cells lies between the tables, otherwise NutsFor will not be able to read the
tables. The total number of soil layers (Nb_Layers) must also be updated in the
General Data File before running the model.

<br>

***Depth and Thickness:***

The depth of the soil layer represents the vertical distance
of the soil layer from the surface of the soil, it is not used in any
calculations. Soil layer thickness determines how thick each soil layer is, it
is recommended that soil layers are set to less than or equal to 20cm thick. Overly thick
soil layers may be liable to over-leaching of nutrients from the soil layers.

<br>

***Bulk Density, Solid Density, and Stoniness:***

Bulk density is defined as fine earth bulk density
(particles less than 2mm in diameter). Solid density is not part of the
calculations of NutsFor, and can be ignored. Stoniness is the percent of soil
particles greater than 2mm in diameter, this parameter affects soil moisture
and hydrology calculations and is important to calculate.

<br>

***Root Fraction and Uptake Fraction per Layer:***

Keeps trace of the root distribution of the stand between
the soil layers, however it does not determine the uptake of nutrients per
layer. The Uptake Fraction per layer parameter truly determines how the stand
extracts nutrients from the soil layers, allowing for greater flexibility in
determining tree uptake dynamics. Intra-annual uptake dynamics are changed
through the Tree Parameter file.

<br>

***pKGibb, pKAl_Precip, pCO2:***

The pKGibb parameter is the -log of the reaction constant of
gibbsite dissolution to free aluminum, similarly the pKAl_precip is the -log of
the reaction constant of Al and its precipitated forms (i.e., the solubility
product). The range of pKAl_precip (or Ksp of Al(OH)3(s)) should be in the
range of 32-35 depending on the pH of the soil layer, pKGibb ranges from 6-9. These
aluminum parameters are important in determining pore water pH, as Al is the
largest contributor of H+ compared to other acids in the model. pCO2 is the
partial pressure of carbon dioxide in the soil solution, it is a constant
multiple of atmospheric CO2 and is <u>not dynamic with decomposition rates.</u>

<br>

***Mineral Area***

This parameter designates the total weatherable mineral surface area of the soil. It is calculated from the equation:

General Equation 1:

$$
(8*X.Clay)+(2.2*X.Silt)+(0.3*X.Sand)
$$

Citation: [@sverdrupCalculatingFieldWeathering1993]

Note, that clays dominant in high area clays may be misrepresented by this equation *(Citation)*

A more detailed equation, which takes into consideration different sand and silt size particles;

General Equation 2:
$$
(8*X.Clay)+(2.2*X.Silt)+(0.3*X.FineSand)+(0.05*X.CoarseSand)
$$
Citation: [@sverdrupGeochemistryKeyUnderstanding1996]

The mineral area parameter is historically difficult to obtain empirically, clay mineralogy plays a large role in determining this parameter, and is seldom measured to its full capacity. The fraction of soil particles in each size class (X.Clay, X.Silt, and X.Sand) are to be calculated from the <u>whole soil</u> (including coarse fragment count), not just the fine particulate fraction. The above approximations of weatherable mineral area do not include the mineral surface area contributed by amorphous minerals such as Al and Fe sesquioxides. They also tend to "breakdown" when soils are high in clay (>20%) [@hodsonDeterminationMineralSurface1998]. In cases where a soil is high in clay, calculated mineral areas must be calibrated to achieve desired weathering rates. It is likely that the Sverdrup 1993 simple surface area equation will under estimate mineral area in high clay soils than over estimate. 

Since this parameter is difficult to calculate, it will be likely that simulated mineral weathering rates are lower than those observed or calculated for a given stand. In this case the mineral weathering rates must be calibrated by increasing (or decreasing, if weathering is too high) the mineral area parameter. Mineral weathering rates are linked to proton concentrations, lower pH stimulates mineral weathering. Mineral weathering thus consumes protons and can be included in the calibration of pH and alkalinity. 

**Soil Moisture Parameters**

1). ***Wilting Point***

   The percent soil moisture which corresponds to the wilting point; i.e., the pressure of water in the soil matrix is at -15kPa. Wilting point may have a different reference pressure depending on the texture of the soil. 

2). ***Field Capacity***

   The percent soil moisture which corresponds to how much water the soil can hold after drainage of excess water. Typically this measurement is set to the reference pressure of -33kPa. 

3). ***Saturation***

   The percent of soil moisture corresponding to all pore space in soil being filled with water. Effective porosity can be measured to obtain this parameter. 

**CEC Parameters and CEC Initial**

1). ***CEC***

   This parameter is the effective cation exchange capacity (ECEC) of each soil layer. This parameter is usually measured for every soil and soil layer for every depth increment, however there are multiple methods through which this can be accomplished (Citation, General technical manual). In general, ECEC can be calculated as:

   General Equation #X.1
   $$
   ECEC= 2[Ca^{+2}]+ 2[Mg^{+2}]+[K^+]+[Na^+]+3[Al^{+3}]+[NH_{4}^{+}]
   $$

2). ***Gapon Selectivity Coefficients (KH_Cation)***

   These coefficients determine the propensity of each cation to be replaced on the CEC with H+.  High selectivity coefficients indicate that a cation has a high affinity for the CEC, and are thus liable to stay on the CEC rather than weather off due to the presence of other cations. Low coefficients will likely lead to high CEC weathering of cations, which may result in high soil solution pH. This is due to both the consumption of protons in the soil solution, which kick off low-affinity cations, as well as the increase in acid neutralizing capacity (ANC) that comes with increased base cation concentrations. This is because ANC is calculated as the sum of base cations minus the sum of acid anions. When ANC is near or above 0, soil solution pH will be difficult to constrain. 

   Gapon coefficients are to be calculated as:

   General Equation #X.2
   $$
   K_{H:Cation^{+n}}= (E_{Cation^{+n}}/[Cation^{+n}])*([H^{+}]/E_{H})^{n}
   $$
   Where;
   $$
   E_{H}=[H^{+}]_{adsorbed}/ECEC
   $$
   and 
   $$
   E_{Cation^{+n}}=[Cation^{+n}]_{adsorbed}/ECEC
   $$
   Note that 
   $$
   n = Valence
   $$
   
   All concentration units are in mmol/L. It should be noted that these values heavily rely on measured initial cation concentrations, and so they may be manipulated to get a better match between adsorbed and dissolved cations. Note that increasing the selectivity coefficient of one cation will change the relative selectivity of all cations. For instance, increasing Ca selectivity will lead to more Ca adsorption to the CEC, which will in turn kick off other cations, assuming the selectivity of the other cations remains the same. 

3). ***CEC Initial***

   This parameter is not under the "CEC parameters" heading in the Soil Parameter file, rather it is located at the bottom of the Soil Parameter File (it it the last table, named CEC Initial). This parameter determines the total adsorbed supply of cations initially on the cation exchange complex. 

   

**AEC Parameters**

   Anion Exchange Capacity (AEC) is implemented in the model for 3 anions; Sulfate, Phosphate, and Chloride. Sulfate adsorption can be modeled using either  a Langmuir or Freundlich adsorption isotherm. Chloride is modeled using the Langmuir model, Phosphate the Freundlich model. Sulfate adsoprtion isotherms can be selected in the General Data File (Input Table 4). 

1). ***Soil Adsorbed Anions Parameters***

Each anion has two AEC adsorption parameters associated with it, Parameter #1 and Parameter #2. 
These parameters will stand for different variables depending on the adsorption isotherm selected. 


2). ***Soil Adsorbed Anions Initial***

\newpage
```{r, echo=FALSE, message=FALSE}

#Soil Temperature File

Parameters_T9<-c("Year", "Month", "Layers (1-n)")

Units_T9<-c("Year", "Month", "Degrees Celsius")

Description_T9<-c("Desginates the year corresponding to layer and temperature data.", "Sepecifies the month.","Specifies the average monthly temperature at each time point.")

text_tbl_9 <- data.frame(
Parameters_T9, Units_T9, Description_T9
)

kbl(text_tbl_9, caption="Soil Temperature File", booktabs = TRUE, col.names= c("Input Parameter", "Units", "Description"), escape=FALSE) %>% kable_styling(full_width = F, latex_options = c("scale_down", "striped", "hold_position"), font_size=12)

```

**Description of Parameters: Soil Temperature File**

The structure of this file is fairly straight forward, for each layer, month, and year of simulation, an average soil temperature is entered. The soil temperature value is used to calculate decomposition and chemical reaction kinetics. Numerous soil-temperature monitoring stations are active around the world [Cite Here.]
   

```{r, echo=FALSE}
Parameter_T3<-c("Litter Concentration (N, Ca, Mg,K, S, P)", "Litter C Pool", "Layer frac (Fine, Coarse, Humus)", "Decomp rate", "CO2FACT", "Nutrient Factor (DOCFACT, N Fact, Ca Fact, Mg Fact, K Fact, S Fact, P Fact", "NULL")

Units_T3<-c("mmol Nutrient/mol C", "$mmol C/m^2$", "N/A", "$mmol/(m^2*mo)$", "N/A", "mmol Nutrient/mol C", "Null")

Description_T3<-c("Determines concentration of nutrient elements in the litter fraction of OM.", "Sets the litter carbon pool, and thus the amount of nutrients per unit area.", "Designates the OM distribution between coarse litter (first column), fine litter (second column), and humus (third column)", "Calibration decomposition factor shows up multiple times in the file for the 3 OM fractions (1-3) and for the mineral soil layers (1-n).", "Calibration factor that determines the proportion of decomposed carbon that effluxes as carbon dioxide.", "Calibration factors for both the 3 OM fractions (1-3) and the mineral soil fractions (1-n). Can be used to calibrate soil solution and liter flow ion fluxes, range from 0 to 1.", "NULL")

text_tbl_3 <- data.frame(
Parameter_T3, Units_T3, Description_T3
)

kbl(text_tbl_3, caption="OM Decomposition File", booktabs=TRUE, col.names= c("Input Parameter", "Units", "Description"), escape=FALSE) %>% kable_styling(full_width = F, latex_options = c("scale_down", "striped", "HOLD_position"), font_size=12)



```

<br>

***Description of Parameters: OM Decomposition***

**Litter Parameters**

Litter parameters can be broken up into 3 sections:

1. Litter Concentration (N, Ca, Mg, K, S, P)
2. Litter Pool (Litter_C_Pool, Litter_Fraction)
3. Litter Nutrient Release Dynamics 

I). Litter Concentration

This table sets the concentration of main  nutrient cations in the litter layer relative to the amount of carbon in the litter. 

II). Soil_Layer:

1). The coarse litter fragment of the litter layer (fresh litter included)

2). The fine litter fragment

3). The humus ("Very fine SOM") fraction

Decomp_Rate: The k of decomposition, determining how much carbon decomposes from litter pools.

 Co2_Fact: Determines the fraction of decomposed carbon which is evolved as carbon dioxide 

N_Fact, Ca_Fact, Mg_Fact, K_Fact, S_Fact, P_Fact: Determines release rate of corresponding nutrient relative to C release due to decomposition. These parameters can be tweaked to globally slow the mobilization of nutrients from the litter pool. 

DOCFACT:

This factor determines the fraction of the decomposed C pool at each time step and for each litter pool which is released as DOC. Increasing this factor increases DOC and thus organic acid (R-) concentrations in the simulated soil. This tends to lower pH according to the set pKa of organic acids (See OA_pKa in Input table 4). 

DOC_Decomp:

Determines the proportion of DOC evolved from decomposing litter that is itself decomposed. This parameter decreases OA (R-), however it does not link back to carbon dioxide release as carbon dioxide concentration is a fixed parameter (See, Input table 2, pCO2)

<br>

### General Files

```{r, echo=FALSE}
Parameter_T4<-c("Start Year", "End Year", "Nb Layers", "Nb Minerals", "Mineral names", "OA pka", "Aluminum", "Phosphoric Acid", "DIC", "Organic acid size", "Nb Tree comp*", "Anion Adsorption isotherms")

Units_T4<-c("Year", "Year", "N/A", "N/A", "N/A", "N/A", "N/A", "N/A","N/A", "Carbon/Charge", "N/A", "N/A")

Description_T4<-c("Determines simulation start year.", "Determines simulation end year.", "Designates number of layers to be read", "Designates the number of minerals", "Lists out the minerals to be simulated", "Designates the pka of organic acid stages of dissolution", "Designates Al pka", "Desingates phosphoric acid pka", "Designates DIC pka", "Determines how many C molecules are present for every negative charge on organic acids.", "Determines the stand's species composition", "Determines adsroption isotherm used for anions (1=langmuir, 2=Freundlich)")

text_tbl_4 <- data.frame(
Parameter_T4, Units_T4, Description_T4
)

kbl(text_tbl_4, caption="General Data File", booktabs = TRUE, col.names= c("Input Parameter", "Units", "Description"), escape=FALSE) %>% kable_styling(full_width = F, latex_options = c("scale_down", "striped", "hold_position"))


```
<br>

**Description of Parameters: General Data File**

***Simulation Length***

Simulation length (the number of years which is simulated) is determined by the Start_Year and End_Year parameters. For example, a starting year of 2015 and an ending year of 2020 is 6 total years of simulation (starting in Jan of 2015 and ending in December of 2020). Note that deposition files and the soil temperature file must be extended by however long the simulation is run for (the program does NOT loop over these files). 

***Acid pka***
Numerous acids have their pKas (-log of their dissolution constant) set here. These parameters can be taken from online chemical databases, assuming an average room temperature (25 degrees celsius).

***Organic Acid Size***
This parameters determines the number of carbons for every charged site on an organic acid; it is used to calculate the charge density of organic acids. Note that this is a global parameter, changing this number changes R- concentrations in all layers. Lowering this parameter leads to a higher charge density (and thus more acidic) soil solution, which tends to cause cations from the CEC to dissolve into solution. 

A potential side effect of high cation concentrations due low charge density is suppressed weathering release of cations, as per equation X.X in Equations. 

<br>

```{r, echo=FALSE}

#Mineral Data File

Parameter_T5<-c("Mineral", "pKH", "pKH2O","pKCO2", "pKr","kH", "kH2O", "kCO2", "kr", "nH", "WAlH",	"WBCH",	"WAlH2O",	"WBCH2O", "nCO2",	"nr",	"$CAl*10^-6$",	"$CR*10^-6$",	"$CBC*10^-6$",	"Ca, Mg, K, Na, Al, Si,	PO4", "Ca.Iso, Mg.Iso, K.Iso	Na.Iso, Al.Iso, Si.Iso, PO4.Iso")

Units_T5<-c("N/A",  "N/A", "N/A","N/A", "N/A","N/A", "N/A", "N/A", "N/A", "N/A", "N/A",	"N/A",	"N/A",	"N/A", "N/A",	"N/A",	"$[Al]*10^-6$",	"$[R]*10^-6$",	"$[BC]*10^-6$",	"Stoichiometric", "N/A" )

Description_T5<-c("Name of mineral.", "Reaction constant of mineral with H+", "Reaction constant of mineral with water.","Reaction constant of mineral with $C{O}_2$", "Reaction constant of mineral with organic acid (R)","Temperature dependence of mineral-H+ reaction.", "Temperature dependence of mineral water reaction.", "Temperature dependence of mineral $C{O}_2$ Reaction", "Temperature dependence of mineral Organic Acid reaction.", "Mineral dissolution H+ reaction order.", "Brake reaction order for Al (${f}_H+$)",	"Brake reaction order for BC (${f}_{H+}$)",	"Brake reaction order for Al (${f}_{H2O}$)",	"Brake reaction order for BC (${f}_{H2O}$)", "Brake reaction order for $C{O}_2$ (${f}_{C{O}_2}$)",	"Brake reaction order for R $({f}_R$)",	"Limiting Al concentration",	"Limiting BC concentration",	"Limiting R- concentration",	"Sets the stoichiometry of each mineral.", "Unknown")


text_tbl_5 <- data.frame(
Parameter_T5, Units_T5, Description_T5
)

kbl(text_tbl_5, caption="Mineral Data File", booktabs = TRUE, col.names= c("Input Parameter", "Units", "Description"), escape=FALSE) %>% kable_styling(full_width = F, latex_options = c("scale_down", "striped", "hold_position"))



```

**Description of Parameters: Mineral Data File**
<br>

***Dissolution Reaction Parameters***
The parameters which determine mineral dissolution dynamics are the equilibrium constants (pK values), the thermal dependencies (k values) and the reaction orders (n values). These are then combined in the following equation:

$$r_j=(k_{H^+}*{[H^+ ]}^{n_{H^{+}}}/f_{H^+}) +(k_{H_{2}O}/f_{H_{2}O}) +(k_{CO_2}*P_{CO_2}^{n_{CO_2}}/f_{CO_2}) +(k_R*[R^- ]^{n_{R^-}}/f_{R^-})$$ 
where

$$ r_j=$$ Weathering Rate

The equation calculates the summation of all chemical species (H+, H2O, CO2, and Organic Acid) has on mineral weathering rate. Each calculation has a restricting coefficient ($$f_{species}$$), which is a product inhibition coefficient discussed in the next sub-section. 


<br>
***Inhibition Reaction Parameters***
The inhibition coefficients are calculated dynamically based on the concentration of cations in soil solution layers. The theoretical reasoning of this parameter is straight forward: the higher the solution concentration of base cations, the lower favorability of the weathering reaction. 

These equations mean that as the base cation concentration of the soil solution increases, the weathering rate will become increasingly limited. The magnitude at which this occurs depends on the identity of the mineral and its defined parameters. An instance where this may become relevant is during calibration of free aluminum concentrations. Free aluminum will react with water in the model to release protons, which generally leads to enhanced mineral weathering as per Equation X. However, if aluminum concentrations are very high, the model will simulate a reduction in mineral weathering, cutting off the positive feedback between aluminum hydrolytic proton release and mineral weathering enhancement. 

Note that the saturation constant (also known as the saturation concentration) sets the maximum solution concentration of each cation in water. The closer the simulated solution concentration is to the saturation constant, the higher the inhibition coefficient becomes and thus the slower the weathering.

New minerals can be added to the NutsFor mineral data file, a more extensive list of minerals is given in [@BGDReviewsSyntheses]. However, note that the exact parameters which control mineral weathering will depend on several real-world dependencies.  


***Stoichiometry and Isometric Substitution***


<br>

### Tree and Stand Files

```{r, echo=FALSE}
#Tree Parameter File: Current conversion issue somewhere here!
Parameter_T6<-c("Foliage.start", "Foliage.End","PET.winter.factor","PET.summer.factor","interception" ,"AET.Reduc","Leaching.alpha","Absorption.alpha","Foliar.target.conc","Percent.variation, foliar","Translocation.Percent","Foliar.Exudation","Foliar.Leaching","Foliar.absorption","Wood.target.conc","Wood.initial.conc","Percent.variation, Wood","Bark.target.conc","Bark.initial.conc","Percent.variation, Bark","Branch.target.conc","Branch.initial.conc","Percent.variation, Branch")

Units_T6<-c("$g/m^2$", "$g/m^2$","Multiple","Multiple","cm" ,"Multiple","N/A","N/A","$\\mu$mol/g","Fraction","Fraction","N/A","N/A","N/A","$\\mu$mol/g","Percent.variation","$\\mu$mol/g","$\\mu$mol/g","Percent.variation","","$\\mu$mol/g","$\\mu$mol/g","Fraction")

Description_T6<-c("Starting biomass of foliage.", "Biomass of foliage at the end of simulation.","Multiplies by winter PET values to enhance or reduce PET.","Multiplies by summer PET values to enhance or reduce PET","Sets the volume of water which canopy can maximally intercept." ,"Multiplies by calculated AET to reduce or enhance AET.","Reaction order for foliar leaching reaction.","Reaction order for foliar adsoprtion reaction.","Determines foliar concentration of nutrients.","Fraction of target concentration which foliage can reach before limitation.","Fraction of foliar nutrients that are translocated to stem during litterfall events.","NULL","NULL","NULL","Wood.target.conc","Wood.initial.conc","Percent.variation, Wood","Bark.target.conc","Bark.initial.conc","Percent.variation, Bark","Branch.target.conc","Branch.initial.conc","Percent.variation, Branch")


text_tbl_6 <- data.frame(
Parameter_T6, Units_T6, Description_T6)

kbl(text_tbl_6, caption="Tree Parameters File", booktabs = TRUE, col.names= c("Input Parameter", "Units", "Description"), escape=FALSE) %>% kable_styling(full_width = F, latex_options = c("scale_down", "striped", "HOLD_position"))



```

**Description of Parameters: Tree Parameter File**

<br>

***Tree Nutrient Content***

The biomass of the tree is spilt into 4 compartments, the non-bark bole (heart-wood and sapwood), the bark, the foliage, and the branches. Each compartment has target nutrient concentration ($\mu$mol/g) for  each major nutrient.There is a percent variation parameter for each nutrient for each biomass compartment, this parameter allows the user to model the threshold of tree nutrient uptake before growth limitation is initiated. For instance, a percent variation of .8 for foliar N would mean that the stand would be able to grow at its full potential with 80% or more of its N demand being met by uptake. 

Initial nutrient concentrations can be set separately from target nutrient concentrations, this allows for the simulation of nutrient deficient or stands with luxurious nutrient uptake at the beginning of the simulation. 

<br>

***Foliar Exchange Reactions*** 

The tree parameter file holds several parameters which will drive foliar leaching, adsorption, exudation, and nutrient translocation processes over the course of the simulated stand.

<br>

1). ***Foliar Leaching***

Foliar leaching parameters describe the intensity at which nutrient leaching occurs from the foliage. Leaching is known to be a major determinant of K cycling in forests, so it is important to include this process even if little is known about throughfall chemistry at the site of interest. The magnitude of leaching is known to depend on the pH of the throughfall, which can accelerate leaching as acidity increases. 

Foliar leaching follows the equation:

$$FolLeach(t, \sigma)=L_{\sigma}*[\sigma]_{Leaf}(t)*DW_{Leaf}(t)*[H^{+}]^{\alpha}$$
Where the $L_{\sigma}$ is the specific leaching rate coefficient of ionic nutrient $\sigma$ ($month^-1$), and

$[\sigma]_{Leaf}(t)$ is the concentration of ionic nutrient $\sigma$ at time $(t)$ in the foliage ($\mu mol*g^-1$), and

$[H^+]^{\alpha}$ is the hydrogen concentration of throughfall to the power of leaching rate dependence $\alpha$ ($\mu$mol/L, unitless). 

<br>

2). ***Foliar Adsorption***

Foliar adsorption is the proccess through which throughfall nutrients are absorbed into the leaf, acting as a kind of foliar nutrient uptake. 

$$FolAbs(t, \sigma)=A_{\sigma}*[\sigma]_{TF}(t)*TF(t)*([\sigma]_{TF}(t))^\beta$$

Where foliar adsorption for nutrient $\sigma$ at time $(t)$ ($FolAbs(t, \sigma)$) ($\mu mol*m^-2*month^-1$), 

$A_{\sigma}$ is the specific adsorption constant ($month^-1$), 

$[\sigma]_{TF}(t)$ is the throughfall concentration of nutrients at time $(t)$ ($\mu mol*L^-1$),

$TF(t)$ is the throughfall flux at time $(t)$ (mm or $L*m^-2$), and

$beta$ is the rate dependence of adsorption (unitless). 

<br>

3). ***Foliar Exudation***



$$FolEx(t,\sigma)=\gamma_{\sigma}*[\sigma]_{Leaf}(t)*DW_{Leaf}(t)$$

Where foliar exudation ($FolEx(t,\sigma)$)) at time step $(t)$ for nutrient $\sigma$,

{$\gamma_\sigma$} is the effective leaf turnover rate of ionic species $\sigma$ ($month^-1$), 

$[\sigma]_{Leaf}(t)$ is the concentration of ionic nutrient $\sigma$ in the foliage ($\mu mol*m^-2$), and

$DW_{Leaf}(t)$ is the dry weight of the leaf at time step $(t)$ ($g*m^-2$). 

<br>

4). ***Translocation (redistribution)***

Translocation allows for the model to store a fraction of the stand's nutrients during litterfall events. This can reduce the uptake demand of the foliar biomass compartment. The equation which calculates translocation in NutsFor is as follows:

$$T_{\sigma}(t)=[\sigma]_{Leaf}(t)*DW_{Litterfall}(t)*TransFact(\sigma)$$
Where $T_{\sigma}(t)$ is the translocation of nutrient $\sigma$ at time $(t)$, 

$[\sigma]_{Leaf}(t)$ is the concentration of nutrient $\sigma$ in the foliage at time $(t)$,

$DW_{Litterfall}(t)$ is the dry weight of litterfall at time $(t)$, and

$TransFact(\sigma)$ is the user-specified fraction of foliar nutrient translocated during each litterfall event. 

<br>

***Hydrology Parameters***
The PET winter and PET summer factors are calibration factors which can be used to modify PET parameters in the Weather Data file. They range from 0 to 1 and serve as constant multiples over the summer and winter PET entries. The user should take into account that the summer and winter defined in the model are those of the Northern, rather than Southern, hemisphere. 

<br>

```{r, echo=FALSE, message=FALSE}
#Stand Harvesting File
Parameter_T7<-c("Year", "Month",	"Stand.Frac", "Wood.Exp.frac", "Bark.Exp.frac", "Branch.Exp.frac", "Foliage.Exp.frac")

Units_T7<-c("Year", "Month", "Fraction", "Fraction", "Fraction", "Fraction", "Fraction")

Description_T7<-c("Designates the year of harvest event.", "Designates the month of harvest event.", "Multiplies by stand biomass, determines what proportion of stand is removed.", "Determines fraction of wood (bole) removed.", "Determines fraction of bark removed", "Determines fraction of branch removed.", "Determines the fraction of foliage removed.")


text_tbl_7 <- data.frame(
Parameter_T7, Units_T7, Description_T7)

kbl(text_tbl_7, caption="Stand Harvesting File", booktabs = TRUE, col.names= c("Input Parameter", "Units", "Description"), escape=FALSE) %>% kable_styling(full_width = F, latex_options = c("scale_down", "striped", "HOLD_position"))


```
***Description of Parameters: Stand Harvesting File***

The Stand Harvesting file is used to dictate when and what intensity of harvest events over the course of a stand. The Year and Month sections designates which year and month a harvest event is to occur. The stand fraction parameter tells to model what fraction of the total stand is harvested (ranges from 0 to 1). If the stand fraction parameter is set below 1, this indicates a partial harvest or a thinning event. The compartment biomass export fractions dictate what fraction of the harvested stand is taken off site, these parameters can be used to test a range of residue removal conditions on the stand. 

Biomass removal is calculated following the equation:

$$HarvestedFraction=Stand.Frac*Export.Frac$$



```{r, echo=FALSE, message=FALSE}
#Tree growth file

Parameter_T8<-c("Wood: Biomass.Start and Increment ", "Bark: Biomass.Start and Increment", "Branch: Biomass.Start and Increment", "Fol.DW.min: Increment", "Fol.DW.max: Increment")

Units_T8<-c("$g/m^2$","$g/m^2$", "$g/m^2$", "$g/m^2$", "$g/m^2$")

Description_T8<-c("Designates the starting bole biomass at start of simulation and yearly growth increment.", "Designates the starting bark biomass at start of simulation and yearly growth increment.", "Designates the starting branch biomass at start of simulation and yearly growth increment.", "Designates the minimum foliar biomass every year.", "Designates the meximum foliar biomass at every time step.") 



text_tbl_8 <- data.frame(
Parameter_T8, Units_T8, Description_T8)

kbl(text_tbl_8, caption="Tree Growth File", booktabs = TRUE, col.names= c("Input Parameter", "Units", "Description"), escape=FALSE) %>% kable_styling(full_width = F, latex_options = c("scale_down", "striped", "HOLD_position"))

```

<br>

***Description of Parameters: Tree Growth File***

The tree growth file contains a growth increment ($g*m^-2*yr^-1$) column for every biomass compartment except for foliage. Foliage instead has a maximum biomass and a minimum biomass column, which allows the user to set the maximum possible foliar biomass and the minimum foliar biomass, such as that achieved in spring and winter. The user should set these parameters using data on tree growth specific to their stand or ecosystem of interest. If relevant, the user can specify the number of trees which composes the stand (in the tree parameters file), however the growth increment of the total stand per year should be a lumped average growth increment of all the trees within the stand.

Note that the initial and ending biomass of the foliage is set in the tree parameters file and not in the tree growth file. 

The user must include growth increment data post-harvest manually. Say, for instance, that a harvest event is to occur in the year 2025, reducing the tree biomass of the stand to 0 kg/ha. The user must have a growth rate entered for 2026 and beyond which aligns with the growth rate of a newly planted stand. The user may also choose to simulate "empty" or 0 growth years incident with gap years between harvest and replanting phases of site usage. 

<br>

## Output Files

There are 60 output files that NutsFor.exe generates, separated into 9 folders. All files are structured in a readable manner, with units *most* designated. All output files are .csv files separated by ";", all can be read using R. Unlike for input parameter files, output files are largely self-explanatory, however some units are not noted, and some file structures are difficult to immediately read into programs such as R. This section will briefly describe file structures and folder contents, without the extensive descriptions offered for input files. It will also offer basic R studio-based approaches to reading and organizing the data for further analysis. 

<br>

**Output Folders**

<br>

***AEC***

The first folder in the Output data directory is the AEC folder. AEC contains anion adsorption data (SO4, PO4, Cl) for each layer, and so the number of .csv files contained in this folder depends on the user-specified number of soil layers. Each file has a year and month column, and AEC data in units of $\\mu$mol/kg and kg/ha. 

***Biomass***

The biomass folder contains the "Plant pool" and "Tree data" files. Plant pool contains (I don't know). The Tree data file contains compartment nutrient content and biomass data for the stand. Nutrient contents are given in units of $\\mu$mol/g and kg/ha. Biomass or "dry weight" is given in kg/ha. 

***Budgets***

The Budgets folder reports the "Above ground fluxes" and "Biological cycle" files. These files contain simplified yearly summary data on nutrient inputs and outputs, and can be used to calculate ecosystem nutrient budgets. The Above ground fluxes files contains deposition fluxes, throughfall flux, net foliar exchanges, litterflow flux, leaching flux, and weathering flux of each nutrient every annual time point. The Biological cycle file contains uptake, litterfall, and organic matter mineralization fluxes. All fluxes are in units of kg/ha/yr. NO3, NH4, SO4, and PO4 are in units of N, S and P (NH4-N, NO3-N, SO4-S, and PO4-P). 

***CEC***

The CEC folder is identical to the AEC folder in basic structure, it holds a csv file for every soil layer specified. Each file contains cation adsorption data in both $\mu$mol/kg and kg/ha. 

***Hydrology***

The hydrology folder has two datafiles, the "Hydrology Daily Output" and the "Hydrology Monthly Output" files. 
The monthly output file is smaller and more practical for use, although they contain the same data distributed 
over different time steps. The file begins by reporting the Year and month of each measurement, then reports 
the rainfall (RF), potential evapotranspiration (PET), the actual evapotranspiration (AET), the throughfall. 

***Litter***

The litter output folder the Litter pool and decomp file, the Litter_kg_ha file, and the litterfall file. 

The litter pool and decomp file holds nutrient data specific to the O-horizon layers. It contains nutrient pool data on the harvest residue litter pool, the coarse litter pool (L1), the fine litter pool (L2), and the humic or very fine litter pool (L3). The file gives data for each pool separately and combined for faster analysis. For each layer, decomp% outputs are given. These values show what percent of O-horizon nutrients has decomposed. The nutrient pool is represented in units of $mmol*m^-2$. 

The next file in the directory is the Litter_kg_ha file. This data file contains the same litter nutrient pool data as the Litter pool and decomp file, but in a more recognizable kg/ha unit. 

The final output file in the Litter directory is the litterfall file. This file contains information on litterfall distribution throughout the time frame simulated. Litterfall dry weight ($g*m^-2$) and nutrient concentrations ($\mu mol*g^-1$ and $\mu mol*m^-2$) are given in this file. 


***Soil Solution***

<br>

The soil solution output folder will contain a throughfall concentration file, a Litterflow concentration file, 
and both a soil solution and leaching layer concentration file for each soil layer specified. All files 
display concentration in units of ($\mu mol*L^{-1}$), except for the leaching layer files, which gives leaching
fluxes in units of ($kg*ha^{-1}$). All data is output on a monthly time step. 

<br>

***SOM***

<br>

The SOM output folder contains a SOM data file for each soil layer specified. The file reports nutrient content 
in the SOM mineral pool in terms of total storage of nutrient every month ($mol*m^{-1}$) and the gain of nutrients every month ($mmol*m^{-2}*month^{-1}$).  


<br>


***Weathering***

***Using R with NutsFor***

This section assumes that the user has basic R studio skills, for more information on general R studio usage see the "Helpful Resources" section of this manual.

For layer-based output folders, such as AEC, CEC, weathering, and soil solution, it is most efficient to read all files from a single output directory into one R dataframe, and use an indexing function to define the individual layers. For instance, a code for reading CEC might look like: 

```{r, eval=FALSE, echo=TRUE}

#Requires this package for code to make sense (pipe operators)
library(dplyr)

#Generates a pattern within "files", locates folder
files <- list.files(path = "~/YourFilePath/Output data/CEC", pattern = "CEC", full.names = TRUE)

#Uses the defined "files", applies the read.csv2 function
#and generates an "id" column unique to each file.
CEC_All<- sapply(files, read.csv2, simplify=FALSE, header=FALSE) %>% 
  bind_rows(.id = "id")

#Designates an index value (1-n) that corresponds to each "id" value, named "group_id" 
CEC_All$group_id <- CEC_All %>% 
  group_by(id)%>%
  group_indices(id)

```

The above code essentially applies an identifying number for each soil layer in a large, aggregated dataset of all the soil layers, which makes it easier to apply graphing functions to the data as well as keep track of data in a single file. Graphing becomes particularly easy, for example the above CEC_All file generated above can be graphed using: 

```{r, eval=FALSE,echo=TRUE}

#Loads the ggplot2 package
library(ggplot2)

#Defines a graph for Ca, defines lines by group_id
CEC_Graph_Ca<-ggplot(CEC_All, aes(x=Date, y=Ca, group=group_id))

#Plots graph
CEC_Graph_Ca

```

<br>

It is likely that dataframes read into R will be in character format rather than numeric. This is because many of the NutsFor output files have 2 rows of character-containing values. Often, this leads to R not being able to read a descriptive header or graph the data correctly. Even if the character values are removed, the data will still be in character format and will not behave as a number in graphical or numerical analysis. To fix this, a simple code can be used:

```{r, eval=FALSE, echo=TRUE}

#Specifies that only columns 2-16 are to be made numeric
CEC_All[c(2:16)]<-lapply(CEC_All[c(2:16)], as.numeric)

```


While R studio is a powerful for analyzing large datasets, it can also be used to generate manuscript-quality tables [Citation] and write dynamic reports or manuscripts [Citation]. Creating such reports can make the following stage of NutsFor usage, calibration, much easier. 

## Calibration

After starting parameters have been measured for the site or approximated from the literature, and once a reliable method of monitoring NutsFor outputs is constructed, the calibration phase can begin. Calibration entails changing initial parameters within some acceptable range until model outputs match observed measurements. What determines the acceptable range of parameter variation depends on what is known about the site, as well as what is known about the standard error of the parameter itself. 

I recommend planning out the process of calibration using workflows. By identifying which parameters are most likely to vary (and thus can be used to calibrate), a calibration workflow can be generated for every sub-module within the greater NutsFor module. The order which each sub-module is calibrated is very important, the sub-modules with the highest level of control over the outputs of the model should be calibrated first, those that are more precise and downstream of multi sub-modules last. Generally, the order I recommend is the same as described in [@munsonNuCMCodeVersion1992], listed below. However, some processes can be calibrated before others, depending on their relative importance in determining model outputs on a site specific basis. 

I also recommend using no more than 2 parameters to calibrate every 1 observed output. This is because the use of 3 or more parameters to calibrate a single output has an infinite amount of ways which the parameters can be ordered or chosen [@sverdrupGeochemistryKeyUnderstanding1996]. Thus, it is important to choose which parameters are allowed to vary for the site in question, and use *only* these parameters for calibration. 


1). **Hydrology**

The calibration of the hydrological sub-module of NutsFor should always occur first, hydrology will affect seasonal decomposition patterns, soil solution concentrations, leaching fluxes, and weathering fluxes. It therefore has control over all other model outputs. To calibrate this system, the user should have some evaporation data for the region to confirm model output. Once the seasonality and magnitude of evaporation (in the model, the Actual Evapotranspiration output or AET) are confirmed against regional data, the hydrology calibration is complete. The user may also view soil moisture parameters over time, these values should be confirmed with collected data or known seasonal patterns. For instance, a soil with a drought season should have soil moisture parameters drop to near wilting point during such events. 

Hydrological outputs are calculated from parameters entered in the Weather Data file, the Soil parameters file, and the Tree data file. The Weather Data file contains information on daily potential evapotranspiration and average air temperature, using the (which equation?) to calculate AET. The soil parameter file will contain soil moisture parameters specific to the site, these parameters will generally be held constant and shouldn't be used to calibrate hydrology. 

To calibrate hydrology AET outputs, the user should either adjust the PET entered in the Weather Data file manually, or use the AET and PET factors in the Tree parameters file to generally calibrate winter and summer PET values. These parameters multiply by the Weather Data file PET or the calculated AET, a value of 1 indicates that the PET and AET is to be the same as entered and calculated, and so forth. 

I found that spring time PET was often over estimated by the reference crop PET calculator that I used, so during my calibrations I chose to manually change PET values for each site I used. If possible, it is always more efficient to directly measured PET and AET for a specific site. 

2). **Throughfall & Deposition**

Calibration of these inputs is rather simple, the user must observe whether or not depositional fluxes of key nutrient cations are correct given the inputs from the Rainfall concentrations, Tree parameters file, and Dry deposition file. The rainfall concentrations file will combine with the Weather data file to determine wet deposition flux, the dry deposition will determine nutrient flux from dry deposition, and the Tree parameters file have various parameters (described above) which dictate foliar leaching and adsorption parameters. All of these files will ultimately be used calculate net deposition of nutrients in the soil at every time step. 

Generally, throughfall fluxes of K+ are significant, a source of data or direct measurement of throughfall should be used to calibrate K+ leaching fluxes as this process is important in determining K+ distribution in soil. Other nutrients, such as Ca and Mg, may experience little leaching or adsorption depending on the forest of interest [@]. 

Once throughfall concentrations and depositions fluxes match those observed or estimated, the calibration can be said to be complete. If little is known about a depositional input, an effort should be made to estimate or measure its contribution to the stand as some forests rely extensively on atmospheric deposition to supply nutrients [@] 

3). **Soil Organic Matter**

Soil Organic matter should be calibrated using the OM decomposition file, there are numerous parameters which control SOM C stabilization. In general, unless data is available, SOM in mineral soil should not build up or decrease over the course of the simulation. The calibration of SOM is dictated by Decomp_rate, C_Assim, DOC_Decomp, and DOC_Assim. The key to SOM calibration is to control DOC leaching and R- concentrations while keeping the SOM C content stable. Decomp_rate is the most sensitive parameter which determines SOM C dynamics, C_Assim and DOC_Assim dictate how much decomposed solid and dissolved carbon are assimilated into the SOM pool, and can be used to enhance or reduce SOM C buildup. DOC_Decomp can be used to reduce DOC leaching. 

4). **Anion Calibration**

Calibration of in-organic anions requires first that an adsorption isotherm is chosen for every anion (Sulfate, Chloride, and Phosphate) in the General Data file, and that a starting adsorption pool of each anion is entered in the Soil Parameters file (under the "Soil Adsorbed anions initial" header). The initial adsorbed pool of anions should either be directly measured of estimated from data in the literature. The parameters which can be used to calibrate anion concentrations are the half saturation constant (parameter 2, Langmuir isotherm) or the isotherm power "n" (parameter 2, Freundlich isotherm). Generally, increasing parameter 2 for the Langmuir isotherm leads to more dynamic anion adsorption, often leading to high initial anion concentrations that equilibrate over time, whereas a smaller value leads to stronger adsorption and lower, although more stable, concentrations. 

If S or P concentrations are too low in the observed layers, trending towards depletion of the dissolved and adsorbed pools, release rates of S and P in the OM decomposition file can be changed to increase S and P mineralization. If this calibration leads to unrealistic gain of S and P in the organic layer, the issue may have its roots in tree uptake per layer, with disproportionate tree uptake depleting the layer over others. In this case, the "Uptake Fraction per Layer" header within the Soil Parameters file can be edited. 

Depending on the role of organic acids at the site, an initial calibration of the soil solution may yield an unrealistically high pH and high acid neutralizing capacity. Organic acids can make up a majority of soil anions in forest ecosystems [@johnsonAnionMobilitySoils1980], however these R- anions are distributed between constantly changing solid and dissolved phases. As NutsFor does not represent solid organic acids, dissolved organic acid can be used to calibrate ANC. The point of this calibration would be to ensure a rough charge balance in the soil solution, avoiding unrealistic chemical behavior derived from a high ANC. R- concentrations can be changed using  the DOCFACT and DOC_Decomp in each organic and soil layer in the OM decomposition file. Increasing the DOC_Fact will increase R- release, whereas increasing DOC_Decomp will decrease R- concentrations. As these parameters are layer specific, calibrating R- in each layer may be tedious. In such a case, I recommend using the organic acid charge density parameter in the General Data file, called "Organic_acid_size", to control R- concentrations. This option will *globally* (for all layers) change R- concentrations in the model, a benefit of using this parameter over the layer specific  DOC_Fact and DOC_Decomp factors is that changing the charge density won't cause a change in DOC mobility in the model, which can help constrain DOC leaching. Lowering Organic_acid_size decreases the number of carbon per negative charge (increasing the charge density and thus also increasing R-), and increasing the parameter decreases the charge density, lowering R- concentrations. 

It is important to calibrate these anions before moving on to cation calibration, all anions will have some control over CEC adsorption and thus cation concentrations. 

5). **Cation Calibration**

Cation concentrations should be calibrated last as every other sub-model can affect cation release through mineral weathering or acidification of the exchange complex. This calibration requires knowledge of cation concentrations in the soil solution, such as those measured by lysimeters, in order to complete calibration. The point of this calibration would be to match simulated cation concentrations to those observed. Another point of constraint on cation concentrations would be leaching fluxes, which can also be calculated from lysimeter measurements. 

Generally, the cations on the exchange complex should not rapidly change-although decadal responses in CEC chemistry are not unreasonable [@]. Gapon selectivity coefficients calculated for each cation will generally exert the greatest control on cation mobility and concentrations in the soil solution. However, I do not suggest using these Gapon coefficients for calibration of cation concentrations. Changing the value of the coefficient for, as example, Ca, will change the relative strength of adsorption for all cations. 

If concentrations are generally too low, the issue may be with hydrological calibration, in which hydrological calibration is not leading to enough evaporation. If hydrology calibration is acceptable, the issue may be with the release rate of nutrient cations from litter and SOM pools. Initially, the release factors of Ca, Mg, and K in the OM decomposition file should be set to 1, and reduced if cation concentrations exceed those desired for calibration, assuming hydrology calibration has been accepted. If the cation concentrations are generally too high, the issue may be with an unbalanced anion calibration, too much mineral weathering, or too weak CEC adsorption. Pin-pointing the source of error in this case requires that the user has a way to visualize these changes in the model graphically, as noted in the previous section. 

The user should be able to directly tell if an over-abundance of anions are responsible for high Ca concentrations as anion concentrations will also be too high, pH and ANC may be too low. In this scenario anion concentrations should be re-calibrated. 


If the user has lysimeter silica concentrations, an extra check on mineral weathering can be completed. Ideally, an approximation of mineral weathering fluxes should be made, however it can be difficult to achieve such a calculation.In such a case, mineral area can be calibrated until silica concentrations match those observed. The model does not simulate the uptake of silica, only mineral weathering and hydrology enact control on silica concentrations. Silica can thus be used as a kind of tracer on the calibration of both hydrology and weathering release rates of cations.  

6). **Final Calibration**

After the above calibration steps has been completed along the time frame of calibration (i.e., the years where soil solution or other confirmation data is available), the user should run the model past the period of time in which confirmational data is available. This ensures that the longer term behavior of the site is reasonable with respect to the expected behavior of the site. I suggest running the model for an additional 10 years, and observing how cation exchange, soil solution concentrations, and anion adsorption change over this time. 

Cations and anions on the exchange complex may steadily deplete over this time period, however a steep decline is unrealistic over such a short time frame [@]. Cation concentrations should be stable within this time frame, although if the stand is modeled to grow quickly, the concentrations might gradually reduce over time. 

Once the initial and final calibrations are complete, the user may move on to the hypothesis testing phase of model usage. 

7). **Alternative Calibration**


## Hypothesis Testing

After the final calibration of a base site, hypothesis testing may begin. This process may undertake many forms. For example, the user may test how changes in atmospheric deposition, soil temperature, harvest scenarios, and growth scenarios affect simulation outputs over whatever time frame desired. Since NutsFor has a Stand Harvesting specific file, which allows for harvest residues to be left over, many hypotheses pertaining to harvest intensity may be tested. If the user wishes to simulate long term nutrient cycling behavior(under any set of conditions),the Weather data, soil temperature, rain fall concentration, and tree growth files must be lengthened such that input data is present for every time point to be simulated. Failure to do so will result in model being unable to run. 

The program does not currently include N-fixation or fertilization specific processes. If these processes occur in the stand, they can be broadly simulated by "dosing" the atmospheric deposition file with regular increments of N or fertilizer nutrients as needed by the user. The user may also include fertilizers as minerals in the Mineral Data file, adjusting mineral reaction parameters to replicate the release rate of the fertilizer.



## List of Equations

### NutsFor Encoded Equations

**Canopy**

**Litter Layer**

**Mineral Weathering**

**Soil Chemistry**

### General Equations

### Github Shoutout

## Literature Cited

<div id="refs"></div>

## Appendix

Appendix, maybe include screenshots of input interface? 