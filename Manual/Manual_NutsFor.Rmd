---
title: "Nutrient Cycling in Forest Ecosystems: User Manual v.()"
author:
   Kaveh Gholamhossein Siah and
   Gregory van Der Heijden
date:  "`r format(Sys.time(), '%d %B %Y')`"
output: 
   pdf_document:
    toc: yes
    toc_depth: 3
    extra_dependencies: "subfig"
geometry: margin=2 cm
fig_caption: yes
citation_package: natbib
bibliography: Manuscript_Test.bib
---

```{r global_options, include=FALSE, message=FALSE}
#This global option holds figures in the correct place (stops floating in pdf)
knitr::opts_chunk$set(fig.pos = 'H')

```

```{r, include=FALSE}
library(kableExtra)

```


<!--Title Page Below, possible background theme/image-->

<!--Insert List of Abbreviations-->
<br>

## Introduction

<!--Meant to be a User guide, maybe a brief history can be mentioned at the end, but the intro should be short and descriptive-->

The Nutrient Cycling in Forested Ecosystems (NutsFor) model is
a stand-level biogeochemical model which simulates the forest nutrient dynamics of 16 chemical species <!--List species-->
These processes include hydrology, soil exchange site chemistry, mineral
weathering, stand growth and uptake, and atmospheric deposition. This manual describes the most recent iteration of NutsFor (version ……), which further includes stand harvest, biomass residues, separate pools of soil water, and other small
changes made to the original model described in van der Heijden et al, 2017. All
changes from the original model are noted with an asterisk (“*”). As NutsFor is
an active project of Gregory van der Heijden, model capabilities are open to change based on collaboration. 

This user manual is intended to give relevant information about the model's capabilities, useful tips regarding its usage, insight into the equations and theory which link model parameters, and information on how to effectively use NutsFor in an R-Studio based environment.



<br>

## Model Start Up

Prior to running or implementing change to model parameters, the user should go through the input and output files for NutsFor using excel. NutsFor does not currently have a built-in method to visualize results, it is recommended that the user use excel macro commands or R to automatically read generated files (which will always output with the same structure) to visualize results. This is highly important in the calibration phase of model implementation.

The model is simple to run, simply double-click or other wise enact the NutsFor.exe file. The model will run and output results to its corresponding .csv files automatically. If the output files are moved from the NutsFor directory or removed, NutsFor will generate new csv files as long as the Output folder is still present in the NutsFor.exe directory. A successful model run will be accommodated by a “Exporting Model Run Data” and “Model Run End-Press Return to Close”. Unsuccessful model runs (i.e., crashes) will result in either the NutsFor.exe closing on its own or on the former messages never appear in the NutsFor.exe terminal.

<br>

## Input Files

There are 11 input files for NutsFor (.nut files). These
files are csv files which can be opened through excel. A full list of the input
parameters, separated by the file they appear in, is shown in the tables below.
Below each table is a more extensive description of each variable and its
effects on model outputs.

<br>

### Deposition Files

<!--Insert units as an image, its way easier-->

```{r, include=FALSE}
text_tbl <- data.frame(
Input= c("Ca, Mg, K, Na, NO3, NH4, SO4, Cl, PO4, DOC, H, Al, Si"),
Units=c("$\\mu$mol/L"),
Description = c("Determines the amount of each species deposited into ecosystem by Dry Deposition")
)



```
<br>

**Description of Parameters: Deposition Files**

The dry deposition file is comparable to the Rain Concentration file. It simply delegates the deposition of chemical species without the deposition of water. The files start with An and Mois (Year and Month Columns), and then lists out chemical species from left to right. 

```{r, echo=FALSE}
kbl(text_tbl, booktabs = T, caption="Dry and Wet Deposition Files", col.names =  c("Input","Units","Description"), escape=FALSE) %>%
kable_styling(full_width = F, latex_options = "scale_down", "hold_position", font_size=12) 
 
```

```{r, echo=FALSE}
#Rainfall Concentrations File
```

```{r, echo=FALSE}
#Weather Data File
```









<br>

 
### Soil Files

```{r, echo=FALSE}


Parameter<-c("Soil Layer", "Soil Layer", "Depth", "Thickness", "Bulk Density", "Solid Density", "Stoniness", "Root Fraction", "pKGibb", "pkAl precip", "pCO2", "Area", "Wilting Point", "Field Capacity", "Saturation", "CEC", "KH Cation", "Percent Mineral Area", "Uptake Fraction Per Layer (all nutrients)", "Nitrification (ks, knit)", "Microbial Turnover", "Organic Matter Parameters", "Soil Solution Initial (Multiple Species)", "Soil Adsorbed Anions Initial", "CEC Initial")

Units<-c("N/A", "N/A", "cm", "cm", "$kg/m^3$", "$kg/m^3$", "Percent", "Fraction", "N/A", "N/A", "Unknown", "$m^2/m^3$", "Percent", "Percent", "Percent", "$c{mol}_c/kg$", "N/A", "Percent", "Fraction (max 1)", "ks: $\\mu$mol/L, knit: Fraction", "Multiple of Microbial Pool", "g Nutrient/kg soil)", "$\\mu$mol/L", "$\\mu$mol/kg", "c${mol}_c$/kg")

Short_Description <-c("Desingates number of layers.", "Assigns layer number to each layer", "Tracks vertical depth of soil layer", "Designates the individual thickness of each soil layer", "N/A", "N/A", "Determines the percent of soil particles greater than 2mm in diameter", "Determines fraction of total tree root biomass in eah layer","Gibbsite formation constant","Al precipitation constant (unused in current version)", "Partial Pressure of CO2","Weatherable mineral area","Soil moisture at which stand cannot extract water", "Soil moisture after excessive water is leached", "Soil moisture at which all pore space is filled with water", "Total cation exchange capacity", "Gapon coefficients for each cation", "Porportion of total mineral area that each individually defined mineral occupies" , "Determines fraction of needed nutrient which stand uptakes from each", "Nitrification constants that determines NO3 production", "Determines fraction of SOM which turns over", "Iniital Amount of Nutrient Mineralized in the SOM pool.", "Concentration of all chemical species at beginning of simulation", "Adsorbed Concentration of anions at the beginning of the simulation", "Sorbed Concentration of Cations to the CEC at the beginning of the simulation")

text_tbl_2 <- data.frame(
Parameter, Units, Short_Description
)

kbl(text_tbl_2, caption="Soil Parameters File", booktabs = TRUE, col.names= c("Input Parameter", "Units", "Description"), escape=FALSE) %>% kable_styling(full_width = F, latex_options = c("scale_down", "striped", "hold_position"), font_size=12)

```

<br>

**Description of Parameters: Soil Parameters**

<!--Keep concise but informative-->

***Soil Layers:***

NutsFor allows any number of soil layers to be set in the
model. Extra layers are added by typing in the new layer quantity into the
Soil_Layer parameter, and adding the new layer to the Soil Parameter file by
parameterizing the new layer as is done for layers before it. When a new layer
is added, the spacing between the different tables in the soil parameters file
is offset, the tables must be cut and pasted such that a single row of blank
cells lies between the tables, otherwise NutsFor will not be able to read the
tables. The total number of soil layers (Nb_Layers) must also be updated in the
General Data File before running the model.

<br>

***Depth and Thickness:***

The depth of the soil layer represents the vertical distance
of the soil layer from the surface of the soil, it is not used in any
calculations. Soil layer thickness determines how thick each soil layer is, it
is recommended that soil layers are set to less than or equal to 20cm thick. Overly thick
soil layers may be liable to over-leaching of nutrients from the soil layers.

<br>

***Bulk Density, Solid Density, and Stoniness:***

Bulk density is defined as fine earth bulk density
(particles less than 2mm in diameter). Solid density is not part of the
calculations of NutsFor, and can be ignored. Stoniness is the percent of soil
particles greater than 2mm in diameter, this parameter affects soil moisture
and hydrology calculations and is important to calculate.

<br>

***Root Fraction and Uptake Fraction per Layer:***

Keeps trace of the root distribution of the stand between
the soil layers, however it does not determine the uptake of nutrients per
layer. The Uptake Fraction per layer parameter truly determines how the stand
extracts nutrients from the soil layers, allowing for greater flexibility in
determining tree uptake dynamics. Intra-annual uptake dynamics are changed
through the Tree Parameter file.

<br>

***pKGibb, pKAl_Precip, pCO2:***

The pKGibb parameter is the -log of the reaction constant of
gibbsite dissolution to free aluminum, similarly the pKAl_precip is the -log of
the reaction constant of Al and its precipitated forms (i.e., the solubility
product). The range of pKAl_precip (or Ksp of Al(OH)3(s)) should be in the
range of 32-35 depending on the pH of the soil layer, pKGibb ranges from 6-9. These
aluminum parameters are important in determining pore water pH, as Al is the
largest contributor of H+ compared to other acids in the model. pCO2 is the
partial pressure of carbon dioxide in the soil solution, it is a constant
multiple of atmospheric CO2 and is <u>not dynamic with decomposition rates.</u>

<br>

***Mineral Area***

This parameter designates the total weatherable mineral surface area of the soil. It is calculated from the equation:

General Equation 1:

$$
(8*X.Clay)+(2.2*X.Silt)+(0.03*X.Sand)
$$

Citation: [@sverdrupCalculatingFieldWeathering1993]

Note, that clays dominant in high area clays may be misrepresented by this equation *(Citation)*

A more detailed equation, which takes into consideration different sand and silt size particles;

General Equation 2:
$$
()+()+()
$$
Citation:

The mineral area parameter is historically difficult to obtain empirically, clay mineralogy plays a large role in determining this parameter, and is seldom measured to its full capacity (SOURCE). The fraction of soil particles in each size class (X.Clay, X.Silt, and X.Sand) are to be calculated from the <u>whole soil</u> (including coarse fragment count), not just the fine particulate fraction. Since this parameter is difficult to calculate, it will be likely that simulated mineral weathering rates are lower than those observed or calculated for a given stand. In this case the mineral weathering rates must be calibrated by increasing (or decreasing, if weathering is too high) the mineral area parameter. Mineral weathering rates are linked to proton concentrations, lower pH stimulates mineral weathering. Mineral weathering thus consumes protons and can be included in the calibration of pH and alkalinity. Thus, another way of calibrating mineral weathering rates can be the calibration of proton concentrations. 

Soil Moisture Parameters

1. Wilting Point

   The percent soil moisture which corresponds to the wilting point; i.e., the pressure of water in the soil matrix is at -15kPa. Wilting point may have a different reference pressure depending on the texture of the soil. 

2. Field Capacity

   The percent soil moisture which corresponds to how much water the soil can hold after drainage of excess water. Typically this measurement is set to the reference pressure of -33kPa. 

3. Saturation

   The percent of soil moisture corresponding to all pore space in soil being filled with water. It can be set as the effective porosity of the soil. 

CEC Parameters and CEC Initial

1. CEC

   This parameter is the effective cation exchange capacity (ECEC) of each soil layer. This parameter is usually measured for every soil and soil layer for every depth increment, however there are multiple methods through which this can be accomplished (Citation, General technical manual). In general, ECEC can be calculated as:

   General Equation #X.1
   $$
   ECEC= 2[Ca^{+2}]+ 2[Mg^{+2}]+[K^+]+[Na^+]+3[Al^{+3}]+[NH_{4}^{+}]
   $$

2. Gapon Selectivity Coefficients (KH_Cation)

   These coefficients determine the propensity of each cation to be replaced on the CEC with H+.  High selectivity coefficients indicate that a cation has a high affinity for the CEC, and are thus liable to stay on the CEC rather than weather off due to the presence of other cations. Low coefficients will likely lead to high CEC weathering of cations, which may result in high soil solution pH. This is due to both the consumption of protons in the soil solution, which kick off low-affinity cations, as well as the increase in acid neutralizing capacity (ANC) that comes with increased base cation concentrations. This is because ANC is calculated as the sum of base cations minus the sum of acid anions. When ANC is near or above 0, soil solution pH will be difficult to constrain. 

   Gapon coefficients are to be calculated as:

   General Equation #X.2
   $$
   K_{H:Cation^{+n}}= (E_{Cation^{+n}}/[Cation^{+n}])*([H^{+}]/E_{H})^{n}
   $$
   Where;
   $$
   E_{H}=[H^{+}]_{adsorbed}/ECEC
   $$
   and 
   $$
   E_{Cation^{+n}}=[Cation^{+n}]_{adsorbed}/ECEC
   $$
   Note that 
   $$
   n = Valence
   $$
   All concentration units are in mmol/L. It should be noted that these values heavily rely on measured initial cation concentrations, and so they may be manipulated to get a better match between adsorbed and dissolved cations. Note that increasing the selectivity coefficient of one cation will change the relative selectivity of all cations. For instance, increasing Ca selectivity will lead to more Ca adsorption to the CEC, which will in turn kick off other cations, assuming the selectivity of the other cations remains the same. 

3. CEC Initial 

   This parameter is not under the "CEC parameters" heading in the Soil Parameter file, rather it is located at the bottom of the Soil Parameter File (it it the last table, named CEC Initial). This parameter determines the total adsorbed supply of cations initially on the cation exchange complex. 

   

4). AEC Parameters

   Anion Exchange Capacity (AEC) is implemented in the model for 3 anions; Sulfate, Phosphate, and Chloride. Sulfate adsorption can be modeled using either  a Langmuir or Freundlich adsorption isotherm. Chloride is modeled using the Langmuir model, Phosphate the Freundlich model. Sulfate adsoprtion isotherms can be selected in the General Data File (Input Table 4). 

   

   1. Soil Adsorbed Anions Parameters

      Each anion has two AEC adsorption parameters associated with it, Parameter #1 and Parameter #2. These parameters will stand for different variables depending on the adsorption isotherm selected. 


   2. Soil Adsorbed Anions Initial

\newpage
```{r, echo=FALSE, message=FALSE}

#Soil Temperature File

Parameters_T9<-c("Year", "Month", "Layers (1-n)")

Units_T9<-c("Year", "Month", "Degrees Celsius")

Description_T9<-c("Desginates the year corresponding to layer and temperature data.", "Sepecifies the month.","Specifies the average monthly temperature at each time point.")

text_tbl_9 <- data.frame(
Parameters_T9, Units_T9, Description_T9
)

kbl(text_tbl_9, caption="Soil Temperature File", booktabs = TRUE, col.names= c("Input Parameter", "Units", "Description"), escape=FALSE) %>% kable_styling(full_width = F, latex_options = c("scale_down", "striped", "hold_position"), font_size=12)

```

**Description of Parameters: Soil Temperature File**

The structure of this file is fairly straight forward, for each layer, month, and year of simulation, an average soil temperature is entered. The soil temperature value is used to calculate decomposition and chemical reaction kinetics. Numerous soil-temperature monitoring stations are active around the world [Cite Here.]
   

```{r, echo=FALSE}
Parameter_T3<-c("Litter Concentration (N, Ca, Mg,K, S, P)", "Litter C Pool", "Layer frac (Fine, Coarse, Humus)", "Decomp rate", "CO2FACT", "Nutrient Factor (DOCFACT, N Fact, Ca Fact, Mg Fact, K Fact, S Fact, P Fact", "NULL")

Units_T3<-c("mmol Nutrient/mol C", "$mmol C/m^2$", "N/A", "$mmol/(m^2*mo)$", "N/A", "mmol Nutrient/mol C", "Null")

Description_T3<-c("Determines concentration of nutrient elements in the litter fraction of OM.", "Sets the litter carbon pool, and thus the amount of nutrients per unit area.", "Designates the OM distribution between coarse litter (first column), fine litter (second column), and humus (third column)", "Calibration decomposition factor shows up multiple times in the file for the 3 OM fractions (1-3) and for the mineral soil layers (1-n).", "Calibration factor that determines the proportion of decomposed carbon that effluxes as carbon dioxide.", "Calibration factors for both the 3 OM fractions (1-3) and the mineral soil fractions (1-n). Can be used to calibrate soil solution and liter flow ion fluxes, range from 0 to 1.", "NULL")

text_tbl_3 <- data.frame(
Parameter_T3, Units_T3, Description_T3
)

kbl(text_tbl_3, caption="OM Decomposition File", booktabs=TRUE, col.names= c("Input Parameter", "Units", "Description"), escape=FALSE) %>% kable_styling(full_width = F, latex_options = c("scale_down", "striped", "HOLD_position"), font_size=12)



```

<br>

***Description of Parameters: OM Decomposition***

**Litter Parameters**

Litter parameters can be broken up into 3 sections:

1. Litter Concentration (N, Ca, Mg, K, S, P)
2. Litter Pool (Litter_C_Pool, Litter_Fraction)
3. Litter Nutrient Release Dynamics 

I). Litter Concentration

This table sets the concentration of main  nutrient cations in the litter layer relative to the amount of carbon in the litter. 

II). Soil_Layer:

1). The coarse litter fragment of the litter layer (fresh litter included)

2). The fine litter fragment

3). The humus ("Very fine SOM") fraction

Decomp_Rate: The k of decomposition, determining how much carbon decomposes from litter pools.

 Co2_Fact: Determines the fraction of decomposed carbon which is evolved as carbon dioxide 

N_Fact, Ca_Fact, Mg_Fact, K_Fact, S_Fact, P_Fact: Determines release rate of corresponding nutrient relative to C release due to decomposition. These parameters can be tweaked to globally slow the mobilization of nutrients from the litter pool. 

DOCFACT:

This factor determines the fraction of the decomposed C pool at each time step and for each litter pool which is released as DOC. Increasing this factor increases DOC and thus organic acid (R-) concentrations in the simulated soil. This tends to lower pH according to the set pKa of organic acids (See OA_pKa in Input table 4). 

DOC_Decomp:

Determines the proportion of DOC evolved from decomposing litter that is itself decomposed. This parameter decreases OA (R-), however it does not link back to carbon dioxide release as carbon dioxide concentration is a fixed parameter (See, Input table 2, pCO2)

<br>

### General Files

```{r, echo=FALSE}
Parameter_T4<-c("Start Year", "End Year", "Nb Layers", "Nb Minerals", "Mineral names", "OA pka", "Aluminum", "Phosphoric Acid", "DIC", "Organic acid size", "Nb Tree comp*", "Anion Adsorption isotherms")

Units_T4<-c("Year", "Year", "N/A", "N/A", "N/A", "N/A", "N/A", "N/A","N/A", "Carbon/Charge", "N/A", "N/A")

Description_T4<-c("Determines simulation start year.", "Determines simulation end year.", "Designates number of layers to be read", "Designates the number of minerals", "Lists out the minerals to be simulated", "Designates the pka of organic acid stages of dissolution", "Designates Al pka", "Desingates phosphoric acid pka", "Designates DIC pka", "Determines how many C molecules are present for every negative charge on organic acids.", "Determines the stand's species composition", "Determines adsroption isotherm used for anions (1=langmuir, 2=Freundlich)")

text_tbl_4 <- data.frame(
Parameter_T4, Units_T4, Description_T4
)

kbl(text_tbl_4, caption="General Data File", booktabs = TRUE, col.names= c("Input Parameter", "Units", "Description"), escape=FALSE) %>% kable_styling(full_width = F, latex_options = c("scale_down", "striped", "hold_position"))


```
<br>

**Description of Parameters: General Data File**

***Simulation Length***

Simulation length (the number of years which is simulated) is determined by the Start_Year and End_Year parameters. For example, a starting year of 2015 and an ending year of 2020 is 6 total years of simulation (starting in Jan of 2015 and ending in December of 2020). Note that deposition files and the soil temperature file must be extended by however long the simulation is run for (the program does NOT loop over these files). 

***Acid pka***
Numerous acids have their pKas (-log of their dissolution constant) set here. These parameters can be taken from online chemical databases, assuming an average room temperature (25 degrees celsius).

***Organic Acid Size***
This parameters determines the number of carbons for every charged site on an organic acid; it is used to calculate the charge density of organic acids. Note that this is a global parameter, changing this number changes R- concentrations in all layers. Lowering this parameter leads to a higher charge density (and thus more acidic) soil solution, which tends to cause cations from the CEC to dissolve into solution. 

A potential side effect of high cation concentrations due low charge density is suppressed weathering release of cations, as per equation X.X in Equations. 

<br>

```{r, echo=FALSE}

#Mineral Data File

Parameter_T5<-c("Mineral", "pKH", "pKH2O","pKCO2", "pKr","kH", "kH2O", "kCO2", "kr", "nH", "WAlH",	"WBCH",	"WAlH2O",	"WBCH2O", "nCO2",	"nr",	"$CAl*10^-6$",	"$CR*10^-6$",	"$CBC*10^-6$",	"Ca, Mg, K, Na, Al, Si,	PO4", "Ca.Iso, Mg.Iso, K.Iso	Na.Iso, Al.Iso, Si.Iso, PO4.Iso")

Units_T5<-c("N/A",  "N/A", "N/A","N/A", "N/A","N/A", "N/A", "N/A", "N/A", "N/A", "N/A",	"N/A",	"N/A",	"N/A", "N/A",	"N/A",	"$[Al]*10^-6$",	"$[R]*10^-6$",	"$[BC]*10^-6$",	"Stoichiometric", "N/A" )

Description_T5<-c("Name of mineral.", "Reaction constant of mineral with H+", "Reaction constant of mineral with water.","Reaction constant of mineral with $C{O}_2$", "Reaction constant of mineral with organic acid (R)","Temperature dependence of mineral-H+ reaction.", "Temperature dependence of mineral water reaction.", "Temperature dependence of mineral $C{O}_2$ Reaction", "Temperature dependence of mineral Organic Acid reaction.", "Mineral dissolution H+ reaction order.", "Brake reaction order for Al (${f}_H+$)",	"Brake reaction order for BC (${f}_{H+}$)",	"Brake reaction order for Al (${f}_{H2O}$)",	"Brake reaction order for BC (${f}_{H2O}$)", "Brake reaction order for $C{O}_2$ (${f}_{C{O}_2}$)",	"Brake reaction order for R $({f}_R$)",	"Limiting Al concentration",	"Limiting BC concentration",	"Limiting R- concentration",	"Sets the stoichiometry of each mineral.", "Unknown")


text_tbl_5 <- data.frame(
Parameter_T5, Units_T5, Description_T5
)

kbl(text_tbl_5, caption="Mineral Data File", booktabs = TRUE, col.names= c("Input Parameter", "Units", "Description"), escape=FALSE) %>% kable_styling(full_width = F, latex_options = c("scale_down", "striped", "hold_position"))



```

**Description of Parameters: Mineral Data File**


<br>

### Tree and Stand Files

```{r, echo=FALSE}
#Tree Parameter File: Current conversion issue somewhere here!
Parameter_T6<-c("Foliage.start", "Foliage.End","PET.winter.factor","PET.summer.factor","interception" ,"AET.Reduc","Leaching.alpha","Absorption.alpha","Foliar.target.conc","Percent.variation, foliar","Translocation.Percent","Foliar.Exudation","Foliar.Leaching","Foliar.absorption","Wood.target.conc","Wood.initial.conc","Percent.variation, Wood","Bark.target.conc","Bark.initial.conc","Percent.variation, Bark","Branch.target.conc","Branch.initial.conc","Percent.variation, Branch")

Units_T6<-c("$g/m^2$", "$g/m^2$","Multiple","Multiple","cm" ,"Multiple","N/A","N/A","$\\mu$mol/g","Fraction","Fraction","N/A","N/A","N/A","$\\mu$mol/g","Percent.variation","$\\mu$mol/g","$\\mu$mol/g","Percent.variation","","$\\mu$mol/g","$\\mu$mol/g","Fraction")

Description_T6<-c("Starting biomass of foliage.", "Biomass of foliage at the end of simulation.","Multiplies by winter PET values to enhance or reduce PET.","Multiplies by summer PET values to enhance or reduce PET","Sets the volume of water which canopy can maximally intercept." ,"Multiplies by calculated AET to reduce or enhance AET.","Reaction order for foliar leaching reaction.","Reaction order for foliar adsoprtion reaction.","Determines foliar concentration of nutrients.","Fraction of target concentration which foliage can reach before limitation.","Fraction of foliar nutrients that are translocated to stem during litterfall events.","NULL","NULL","NULL","Wood.target.conc","Wood.initial.conc","Percent.variation, Wood","Bark.target.conc","Bark.initial.conc","Percent.variation, Bark","Branch.target.conc","Branch.initial.conc","Percent.variation, Branch")


text_tbl_6 <- data.frame(
Parameter_T6, Units_T6, Description_T6)

kbl(text_tbl_6, caption="Tree Parameters File", booktabs = TRUE, col.names= c("Input Parameter", "Units", "Description"), escape=FALSE) %>% kable_styling(full_width = F, latex_options = c("scale_down", "striped", "HOLD_position"))



```

**Description of Parameters: Tree Parameter File**

```{r, echo=FALSE, message=FALSE}
#Stand Harvesting File
Parameter_T7<-c("Year", "Month",	"Stand.Frac", "Wood.Exp.frac", "Bark.Exp.frac", "Branch.Exp.frac", "Foliage.Exp.frac")

Units_T7<-c("Year", "Month", "Fraction", "Fraction", "Fraction", "Fraction", "Fraction")

Description_T7<-c("Designates the year of harvest event.", "Designates the month of harvest event.", "Multiplies by stand biomass, determines what proportion of stand is removed.", "Determines fraction of wood (bole) removed.", "Determines fraction of bark removed", "Determines fraction of branch removed.", "Determines the fraction of foliage removed.")


text_tbl_7 <- data.frame(
Parameter_T7, Units_T7, Description_T7)

kbl(text_tbl_7, caption="Stand Harvesting File", booktabs = TRUE, col.names= c("Input Parameter", "Units", "Description"), escape=FALSE) %>% kable_styling(full_width = F, latex_options = c("scale_down", "striped", "HOLD_position"))


```
***Description of Parameters: Stand Harvesting File***



```{r, echo=FALSE, message=FALSE}
#Tree growth file

Parameter_T8<-c("Wood: Biomass.Start and Increment ", "Bark: Biomass.Start and Increment", "Branch: Biomass.Start and Increment", "Fol.DW.min: Increment", "Fol.DW.max: Increment")

Units_T8<-c("$g/m^2$","$g/m^2$", "$g/m^2$", "$g/m^2$", "$g/m^2$")

Description_T8<-c("Designates the starting bole biomass at start of simulation and yearly growth increment.", "Designates the starting bark biomass at start of simulation and yearly growth increment.", "Designates the starting branch biomass at start of simulation and yearly growth increment.", "Designates the minimum foliar biomass every year.", "Designates the meximum foliar biomass at every time step.") 



text_tbl_8 <- data.frame(
Parameter_T8, Units_T8, Description_T8)

kbl(text_tbl_8, caption="Tree Growth File", booktabs = TRUE, col.names= c("Input Parameter", "Units", "Description"), escape=FALSE) %>% kable_styling(full_width = F, latex_options = c("scale_down", "striped", "HOLD_position"))

```
<br>

***Description of Parameters: Tree Growth File***






## Output Files

There are 60 output files that NutsFor.exe generates, separated into 9 folders. All files are structured in a readable manner, with units *most* designated. All output files are .csv files separated by ";", all can be read using R. Unlike for input parameter files, output files are largely self-explanatory, however some units are not noted, and some file structures are difficult to immediately read into programs such as R. This section will briefly describe file structures and folder contents, without the extensive descriptions offered for input files. It will also offer basic R studio-based approaches to reading and organizing the data for further analysis. 

**Output Folders**

***AEC***

The first folder in the Output data directory is the AEC folder. AEC contains anion adsorption data (SO4, PO4, Cl) for each layer, and so the number of .csv files contained in this folder depends on the user-specified number of soil layers. Each file has a year and month column, and AEC data in units of $\\mu$mol/kg and kg/ha. 

***Biomass***

The biomass folder contains the "Plant pool" and "Tree data" files. Plant pool contains (I don't know). The Tree data file contains compartment nutrient content and biomass data for the stand. Nutrient contents are given in units of $\\mu$mol/g and kg/ha. Biomass or "dry weight" is given in kg/ha. 

***Budgets***

The Budgets folder reports the "Above ground fluxes" and "Biological cycle" files. These files contain simplified yearly summary data on nutrient inputs and outputs, and can be used to calculate ecosystem nutrient budgets. The Above ground fluxes files contains deposition fluxes, throughfall flux, net foliar exchanges, litterflow flux, leaching flux, and weathering flux of each nutrient every annual time point. The Biological cycle file contains uptake, litterfall, and organic matter mineralization fluxes. All fluxes are in units of kg/ha/yr. NO3, NH4, SO4, and PO4 are in units of N, S and P (NH4-N, NO3-N, SO4-S, and PO4-P). 

***CEC***

The CEC folder is identical to the AEC folder in basic structure, it holds a csv file for every soil layer specified. Each file contains cation adsorption data in both $\\\\mu$mol/kg and kg/ha. 

***Hydrology***

The hydrology folder has two datafiles, the "Hydrology Daily Output" and the "Hydrology Monthly Output" files. The monthly output file is smaller and more practical for use, although they contain the same data distributed over different time steps. The file begins by reporting the Year and month of each meaurement, then reports the rainfall (RF), potential evapotranspiration (PET), the actual evapotranspiration (AET), the throughfall 

***Litter***

***Soil Solution***

***SOM***

***Weathering***

***Using R with NutsFor***

This section assumes that the user has basic R studio skills, for more information on general R studio usage see the "Helpful Resources" section of this manual.

For layer-based output folders, such as AEC, CEC, weathering, and soil solution, it is most efficient to read all files from a single output directory into one R dataframe, and use an indexing function to define the individual layers. For instance, a code for reading CEC might look like: 

```{r, eval=FALSE, echo=TRUE}

#Requires this package for code to make sense (pipe operators)
library(dplyr)

#Generates a pattern within "files", locates folder
files <- list.files(path = "~/YourFilePath/Output data/CEC", pattern = "CEC", full.names = TRUE)

#Uses the defined "files", applies the read.csv2 function
#and generates an "id" column unique to each file.
CEC_All<- sapply(files, read.csv2, simplify=FALSE, header=FALSE) %>% 
  bind_rows(.id = "id")

#Designates an index value (1-n) that corresponds to each "id" value, named "group_id" 
CEC_All$group_id <- CEC_All %>% 
  group_by(id)%>%
  group_indices(id)

```

The above code essentially applies an identifying number for each soil layer in a large, aggregated dataset of all the soil layers, which makes it easier to apply graphing functions to the data as well as keep track of data in a single file. Graphing becomes particularly easy, for example the above CEC_All file generated above can be graphed using: 

```{r, eval=FALSE,echo=TRUE}

#Loads the ggplot2 package
library(ggplot2)

#Defines a graph for Ca, defines lines by group_id
CEC_Graph_Ca<-ggplot(CEC_All, aes(x=Date, y=Ca, group=group_id))

#Plots graph
CEC_Graph_Ca

```

<br>

It is likely that dataframes read into R will be in character format rather than numeric. This is because many of the NutsFor output files have 2 rows of character-containing values. Often, this leads to R not being able to read a descriptive header or graph the data correctly. Even if the character values are removed, the data will still be in character format and will not behave as a number in graphical or numerical analysis. To fix this, a simple code can be used:

```{r, eval=FALSE, echo=TRUE}

#Specifies that only columns 2-16 are to be made numeric
CEC_All[c(2:16)]<-lapply(CEC_All[c(2:16)], as.numeric)

```


While R studio is a powerful for analyzing large datasets, it can also be used to generate manuscript-quality tables [Citation] and write dynamic reports or manuscripts [Citation].  


## Calibration

<!--Disclaimer about site specific differences-->

<!--Describe general calibration steps, pH, weathering, ANC, ion concentrations-->

## Hypothesis Testing

## List of Equations

### NutsFor Encoded Equations

<!--~~List Gregory's equation table here, with updated sulfate ads.~-->

### General Equations

## Helpful Resources

### Learning R
#### Basic R Resources
#### Advanced R for Building Projects

### Github

### Modeling

## Literature Cited

<div id="refs"></div>

## Appendix

Appendix, maybe include screenshots of input interface? 